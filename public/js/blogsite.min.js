(function(){angular.module("blogsiteApp",["ngRoute","ui.bootstrap"]);function e(e,r){e.when("/",{templateUrl:"userhome/userhome.view.html",controller:"userhomeCtrl",controllerAs:"vm"}).when("/blog",{templateUrl:"blog/bloglist.view.html",controller:"bloglistCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"userhome/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});r.html5Mode(true)}var r=function(){var e=this;e.linkname="angular test"};var t=function(e){var r=this;r.popupLoginForm=function(){alert("Let' log on")}};var o=function(){var e=this;e.modifiedOn=new Date};angular.module("blogsiteApp").config(["$routeProvider","$locationProvider",e]).controller("indexCtrl",r).controller("navibarCtrl",t).controller("bloglistCtrl",o)})();(function(){angular.module("blogsiteApp").controller("userhomeCtrl",e);e.$inject=["$scope","blogsiteData","authentication"];function e(e,r,t){var o=this;o.message="Searching for the user";var n={password:"eat-the-living",email:"davidmhu@sina.com"};t.login(n);r.getUserinfo().success(function(e){o.message=e?"":"No user found";o.user=e}).error(function(e){o.message="Sorry, something's gone wrong, please try again later"})}})();(function(){angular.module("blogsiteApp").controller("registerCtrl",e);e.$inject=["$scope","$location","blogsiteData","authentication"];function e(e,r,t,o){var n=this;n.user={};n.submit=function(){n.message="";if(e.registerForm.$pristine){n.message="Please fill the form first before you submit";return}if(e.registerForm.$invalid){n.message="There are errors in the form ,please correct them";return}if(!n.user.password1||n.user.password1!==n.user.password2){n.message="not valid password or two passwords not equal";return}n.user.password=n.user.password1;o.register(n.user);t.getUserinfo().success(function(e){n.message=" user is registered";n.user=e}).error(function(e){n.message="Sorry, something's gone wrong, please try again later";return});console.log("submit");r.path("/")}}})();(function(){angular.module("blogsiteApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,r){var t=function(e){r.localStorage["blogsite-token"]=e};var o=function(){return r.localStorage["blogsite-token"]};var n=function(){var e=o();if(e){var t=JSON.parse(r.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var s=function(){if(n()){var e=o();var t=JSON.parse(r.atob(e.split(".")[1]));return{email:t.email,name:t.name}}};register=function(r){return e.post("/api/register",r).success(function(e){t(e.token)})};login=function(r){return e.post("/api/login",r).success(function(e){t(e.token)})};logout=function(){r.localStorage.removeItem("blogsite-token")};return{currentUser:s,saveToken:t,getToken:o,isLoggedIn:n,register:register,login:login,logout:logout}}})();(function(){angular.module("blogsiteApp").service("blogsiteData",e);e.$inject=["$http","authentication"];function e(e,r){var t=function(){if(r.isLoggedIn()){var t=r.currentUser();console.log(t);return e.get("/api/user/"+t.email,{headers:{Authorization:"Bearer "+r.getToken()}})}};return{getUserinfo:t}}})();