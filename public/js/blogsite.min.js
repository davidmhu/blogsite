(function(){angular.module("blogsiteApp",["ngRoute","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"userhome/userhome.view.html",controller:"userhomeCtrl",controllerAs:"vm"}).when("/blog",{templateUrl:"blog/bloglist.view.html",controller:"bloglistCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}var t=function(){var e=this;e.linkname="angular test"};var o=function(e){var t=this;t.popupLoginForm=function(){alert("Let' log on")}};var n=function(){var e=this;e.modifiedOn=new Date};angular.module("blogsiteApp").config(["$routeProvider","$locationProvider",e]).controller("indexCtrl",t).controller("navibarCtrl",o).controller("bloglistCtrl",n)})();(function(){angular.module("blogsiteApp").controller("userhomeCtrl",e);e.$inject=["$scope","blogsiteData","authentication"];function e(e,t,o){var n=this;n.message="Searching for the user";var r={password:"eat-the-living",email:"davidmhu@sina.com"};o.login(r);t.getUserinfo().success(function(e){n.message=e?"":"No user found";n.user=e}).error(function(e){n.message="Sorry, something's gone wrong, please try again later"})}})();(function(){angular.module("blogsiteApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var o=function(e){t.localStorage["blogsite-token"]=e};var n=function(){return t.localStorage["blogsite-token"]};var r=function(){var e=n();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var i=function(){if(r()){var e=n();var o=JSON.parse(t.atob(e.split(".")[1]));return{email:o.email,name:o.name}}};register=function(t){return e.post("/api/register",t).success(function(e){o(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){o(e.token)})};logout=function(){t.localStorage.removeItem("blogsite-token")};return{currentUser:i,saveToken:o,getToken:n,isLoggedIn:r,register:register,login:login,logout:logout}}})();(function(){angular.module("blogsiteApp").service("blogsiteData",e);e.$inject=["$http","authentication"];function e(e,t){var o=function(){if(t.isLoggedIn()){var o=t.currentUser();console.log(o);return e.get("/api/user/"+o.email,{headers:{Authorization:"Bearer "+t.getToken()}})}};return{getUserinfo:o}}})();